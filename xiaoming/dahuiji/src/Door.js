/** * Create By Liangdong * */var Door = cc.Sprite.extend({    _state: null,    _doorNormal: null,    _doorOpen: null,    _surprised: null,    _knob: null,    _mother: null,    _tinl: null,    _tinm: null,    ctor: function() {        this._super();    },    init: function() {        this.config();        this._doorNormal = cc.Sprite.create(s_door_normal);        g_utils.setPPS(this._doorNormal, cc.p(0,0), cc.p(0,0));        this.addChild(this._doorNormal);        this._doorOpen = cc.Sprite.create(s_door_open);        this._doorOpen.setVisible(false);        g_utils.setPPS(this._doorOpen, cc.p(0,0), cc.p(0,0));        this.addChild(this._doorOpen);        this._surprised = cc.Sprite.create(s_door_surprised);        this._surprised.setVisible(false);        g_utils.setPPS(this._surprised, cc.p(-50,460), cc.p(0,0));        this.addChild(this._surprised);        this._knob = cc.Sprite.create(s_doorknob);        g_utils.setPPS(this._knob, cc.p(91,265), cc.p(0.2,0.2));        this.addChild(this._knob);    },    config: function() {        this._name = "door";        this.initWithFile(s_tm);        g_utils.setPPS(this, cc.p(820,60), cc.p(0,0));    },    doorReaOpen: function() {        if(this._state)            return false;        this._state = true;        var rotate = cc.RotateBy.create(1, 90);//        var rep1 = cc.RepeatForever.create(rotate); //循环旋转        this._knob.runAction(cc.Sequence.create(            rotate,            cc.CallFunc.create(this.doorOpen,this),            rotate.reverse(),//            cc.DelayTime.create(2),            cc.CallFunc.create(this.surprised,this)        ) );//执行        return true;    },    doorOpen: function() {        this._doorNormal.setVisible(false);        this._knob.setVisible(false);        this._doorOpen.setVisible(true);//        this._tinl = setInterval(function(){this._gameLayer.flyTextM(2);}.bind(this), 400);    },    surprised: function() {        if(this._gameLayer._pc._frame == 0)        {            this._surprised.setVisible(true);            var blink = cc.Blink.create(2, 10);            this._surprised.runAction(blink);            cc.AudioEngine.getInstance().playEffect(s_mother, false);            this._tinm = setInterval(function(){this._gameLayer.flyTextM(2);}.bind(this), 800);        }        else        {            this.doorClose();        }    },    doorClose: function() {        this._knob.removeFromParent(true);        this._doorNormal.setVisible(true);        this._surprised.setVisible(false);        this._doorOpen.setVisible(false);        this._state = false;        this._knob = cc.Sprite.create(s_doorknob);        g_utils.setPPS(this._knob, cc.p(91,265), cc.p(0.2,0.2));        this.addChild(this._knob);//        clearInterval( this._tinl);        clearInterval( this._tinm);    }});Door.create = function() {    var obj = new Door();    obj.init();    return obj;};